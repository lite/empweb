%%
%%
-module(empweb_biz_file_util).

%% ==========================================================================
%% Экспортируемые функции
%% ==========================================================================

%%
%% Списки языков
%%
-export([
    create/0
]).


%% ==========================================================================
%% Внешние функции
%% ==========================================================================

%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Списки языков
%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%[   {isres,false},
    %{filebody,<<"">>
    %{filename,<<"tvzavr-skip.png">>},
    %{nchanks,2},
    %{contenttype,undefined},
    %{fileextension,<<"png">>}
%]


coords(x140, body)->
    [{<<"231_95.png">>,15},
      {<<"232_95.png">>,25},
      {<<"233_95.png">>,18},
      {<<"234_95.png">>,22},
      {<<"235_95.png">>,18},
      {<<"236_95.png">>,23},
      {<<"237_95.png">>,36},
      {<<"238_95.png">>,20},
      {<<"239_95.png">>,24},
      {<<"240_95.png">>,18},
      {<<"251_95.png">>,27},
      {<<"252_95.png">>,17},
      {<<"253_95.png">>,23},
      {<<"254_95.png">>,26},
      {<<"255_95.png">>,23},
      {<<"256_95.png">>,14},
      {<<"257_95.png">>,28},
      {<<"259_95.png">>,28},
      {<<"260_95.png">>,31},
      {<<"261_95.png">>,13},
      {<<"262_95.png">>,28},
      {<<"278_95.png">>,20},
      {<<"279_95.png">>,29},
      {<<"281_95.png">>,18},
      {<<"282_95.png">>,32},
      {<<"283_95.png">>,52},
      {<<"284_95.png">>,32},
      {<<"285_95.png">>,40},
      {<<"286_95.png">>,25},
      {<<"287_95.png">>,25},
      {<<"288_95.png">>,36},
      {<<"289_95.png">>,19},
      {<<"290_95.png">>,35},
      {<<"291_95.png">>,34},
      {<<"292_95.png">>,32},
      {<<"293_95.png">>,32},
      {<<"294_95.png">>,24}];

coords(x242, body)->
    [{<<"293_95.png">>,61},
      {<<"0002.png">>,25},
      {<<"0003.png">>,24},
      {<<"0004.png">>,40},
      {<<"0005.png">>,44},
      {<<"235_95.png">>,44},
      {<<"236_95.png">>,42},
      {<<"237_95.png">>,57},
      {<<"238_95.png">>,40},
      {<<"239_95.png">>,42},
      {<<"240_95.png">>,30},
      {<<"251_95.png">>,48},
      {<<"252_95.png">>,31},
      {<<"253_95.png">>,41},
      {<<"254_95.png">>,55},
      {<<"255_95.png">>,39},
      {<<"256_95.png">>,25},
      {<<"259_95.png">>,44},
      {<<"260_95.png">>,50},
      {<<"261_95.png">>,21},
      {<<"262_95.png">>,49},
      {<<"278_95.png">>,34},
      {<<"279_95.png">>,53},
      {<<"281_95.png">>,34},
      {<<"282_95.png">>,54},
      {<<"283_95.png">>,93},
      {<<"284_95.png">>,59},
      {<<"286_95.png">>,65},
      {<<"287_95.png">>,47},
      {<<"288_95.png">>,73},
      {<<"289_95.png">>,38},
      {<<"290_95.png">>,67},
      {<<"291_95.png">>,74},
      {<<"292_95.png">>,63},
      {<<"0001.png">>,37}];


coords(x242, head)->
    [{<<"0001.png">>,{[{<<"x">>,36},{<<"y">>,-3}]}},
      {<<"0002.png">>,{[{<<"x">>,40},{<<"y">>,-2}]}},
      {<<"0003.png">>,{[{<<"x">>,23},{<<"y">>,-7}]}},
      {<<"0004.png">>,{[{<<"x">>,56},{<<"y">>,-2}]}},
      {<<"0005.png">>,{[{<<"x">>,24},{<<"y">>,-3}]}},
      {<<"0007.png">>,{[{<<"x">>,34},{<<"y">>,5}]}},
      {<<"0008.png">>,{[{<<"x">>,28},{<<"y">>,6}]}},
      {<<"0009.png">>,{[{<<"x">>,48},{<<"y">>,-2}]}},
      {<<"0010.png">>,{[{<<"x">>,35},{<<"y">>,1}]}},
      {<<"0011.png">>,{[{<<"x">>,66},{<<"y">>,0}]}},
      {<<"0012.png">>,{[{<<"x">>,28},{<<"y">>,2}]}},
      {<<"0013.png">>,{[{<<"x">>,24},{<<"y">>,-5}]}},
      {<<"0014.png">>,{[{<<"x">>,55},{<<"y">>,3}]}},
      {<<"0015.png">>,{[{<<"x">>,31},{<<"y">>,0}]}},
      {<<"0016.png">>,{[{<<"x">>,40},{<<"y">>,11}]}},
      {<<"0018.png">>,{[{<<"x">>,50},{<<"y">>,0}]}},
      {<<"0019.png">>,{[{<<"x">>,22},{<<"y">>,0}]}},
      {<<"0020.png">>,{[{<<"x">>,23},{<<"y">>,0}]}},
      {<<"262.png">>,{[{<<"x">>,23},{<<"y">>,1}]}},
      {<<"263.png">>,{[{<<"x">>,26},{<<"y">>,-2}]}},
      {<<"266.png">>,{[{<<"x">>,36},{<<"y">>,3}]}},
      {<<"268.png">>,{[{<<"x">>,24},{<<"y">>,2}]}},
      {<<"269.png">>,{[{<<"x">>,35},{<<"y">>,0}]}},
      {<<"271.png">>,{[{<<"x">>,41},{<<"y">>,-3}]}},
      {<<"272.png">>,{[{<<"x">>,26},{<<"y">>,1}]}},
      {<<"273.png">>,{[{<<"x">>,29},{<<"y">>,0}]}},
      {<<"277.png">>,{[{<<"x">>,21},{<<"y">>,-3}]}},
      {<<"280.png">>,{[{<<"x">>,27},{<<"y">>,4}]}},
      {<<"281.png">>,{[{<<"x">>,24},{<<"y">>,5}]}},
      {<<"282.png">>,{[{<<"x">>,31},{<<"y">>,-24}]}},
      {<<"283.png">>,{[{<<"x">>,40},{<<"y">>,-30}]}},
      {<<"286.png">>,{[{<<"x">>,25},{<<"y">>,5}]}},
      {<<"287.png">>,{[{<<"x">>,68},{<<"y">>,-2}]}},
      {<<"288.png">>,{[{<<"x">>,32},{<<"y">>,-16}]}},
      {<<"289.png">>,{[{<<"x">>,41},{<<"y">>,-3}]}},
      {<<"290.png">>,{[{<<"x">>,23},{<<"y">>,0}]}},
      {<<"293.png">>,{[{<<"x">>,28},{<<"y">>,5}]}},
      {<<"294.png">>,{[{<<"x">>,47},{<<"y">>,0}]}},
      {<<"295.png">>,{[{<<"x">>,37},{<<"y">>,3}]}},
      {<<"297.png">>,{[{<<"x">>,32},{<<"y">>,0}]}},
      {<<"298.png">>,{[{<<"x">>,23},{<<"y">>,3}]}},
      {<<"300.png">>,{[{<<"x">>,28},{<<"y">>,2}]}},
      {<<"301.png">>,{[{<<"x">>,32},{<<"y">>,-3}]}},
      {<<"302.png">>,{[{<<"x">>,35},{<<"y">>,0}]}},
      {<<"303.png">>,{[{<<"x">>,42},{<<"y">>,-15}]}},
      {<<"304.png">>,{[{<<"x">>,22},{<<"y">>,8}]}},
      {<<"307.png">>,{[{<<"x">>,26},{<<"y">>,-1}]}},
      {<<"308.png">>,{[{<<"x">>,24},{<<"y">>,-4}]}},
      {<<"309.png">>,{[{<<"x">>,73},{<<"y">>,0}]}},
      {<<"310.png">>,{[{<<"x">>,20},{<<"y">>,0}]}},
      {<<"312.png">>,{[{<<"x">>,30},{<<"y">>,2}]}},
      {<<"313.png">>,{[{<<"x">>,23},{<<"y">>,2}]}},
      {<<"314.png">>,{[{<<"x">>,50},{<<"y">>,-4}]}},
      {<<"315.png">>,{[{<<"x">>,24},{<<"y">>,4}]}},
      {<<"316.png">>,{[{<<"x">>,34},{<<"y">>,-1}]}},
      {<<"317.png">>,{[{<<"x">>,25},{<<"y">>,-1}]}},
      {<<"318.png">>,{[{<<"x">>,38},{<<"y">>,2}]}},
      {<<"319.png">>,{[{<<"x">>,23},{<<"y">>,-12}]}},
      {<<"320.png">>,{[{<<"x">>,42},{<<"y">>,-3}]}},
      {<<"321.png">>,{[{<<"x">>,47},{<<"y">>,-6}]}},
      {<<"322.png">>,{[{<<"x">>,26},{<<"y">>,4}]}},
      {<<"323.png">>,{[{<<"x">>,60},{<<"y">>,0}]}},
      {<<"324.png">>,{[{<<"x">>,32},{<<"y">>,-7}]}},
      {<<"325.png">>,{[{<<"x">>,47},{<<"y">>,-22}]}},
      {<<"326.png">>,{[{<<"x">>,41},{<<"y">>,-5}]}},
      {<<"328.png">>,{[{<<"x">>,57},{<<"y">>,0}]}},
      {<<"329.png">>,{[{<<"x">>,23},{<<"y">>,-3}]}}];


coords(x140, head)->
 [{<<"261.png">>,16},
  {<<"262.png">>,17},
  {<<"263.png">>,19},
  {<<"264.png">>,18},
  {<<"266.png">>,23},
  {<<"267.png">>,17},
  {<<"268.png">>,18},
  {<<"269.png">>,25},
  {<<"271.png">>,28},
  {<<"272.png">>,18},
  {<<"273.png">>,20},
  {<<"274.png">>,22},
  {<<"275.png">>,20},
  {<<"276.png">>,28},
  {<<"277.png">>,15},
  {<<"279.png">>,19},
  {<<"280.png">>,18},
  {<<"281.png">>,14},
  {<<"282.png">>,19},
  {<<"283.png">>,17},
  {<<"284.png">>,33},
  {<<"285.png">>,16},
  {<<"286.png">>,16},
  {<<"287.png">>,29},
  {<<"288.png">>,18},
  {<<"289.png">>,26},
  {<<"290.png">>,15},
  {<<"291.png">>,31},
  {<<"292.png">>,32},
  {<<"293.png">>,18},
  {<<"294.png">>,29},
  {<<"295.png">>,21},
  {<<"296.png">>,22},
  {<<"297.png">>,21},
  {<<"298.png">>,15},
  {<<"299.png">>,38},
  {<<"300.png">>,19},
  {<<"301.png">>,23},
  {<<"302.png">>,22},
  {<<"303.png">>,26},
  {<<"304.png">>,16},
  {<<"305.png">>,20},
  {<<"306.png">>,27},
  {<<"307.png">>,17},
  {<<"308.png">>,19},
  {<<"309.png">>,56},
  {<<"310.png">>,16},
  {<<"311.png">>,20},
  {<<"312.png">>,21},
  {<<"313.png">>,16},
  {<<"314.png">>,33},
  {<<"315.png">>,15},
  {<<"316.png">>,22},
  {<<"317.png">>,17},
  {<<"318.png">>,31},
  {<<"319.png">>,18},
  {<<"320.png">>,28},
  {<<"321.png">>,28},
  {<<"322.png">>,19},
  {<<"323.png">>,36},
  {<<"324.png">>,21},
  {<<"325.png">>,27},
  {<<"326.png">>,20},
  {<<"327.png">>,16},
  {<<"328.png">>,39},
  {<<"329.png">>,18}].


get_coords(Name, Site, Part) ->
    make_coords(proplists:get_value(Name, coords(Site, Part))).


make_coords({[{<<"x">>,X},{<<"y">>, Y}]})->
    [{x,X},{y, Y}];

make_coords(X)->
    [{x,X},{y, 0}].


create()->
    [
        create_type([x242, x140], head, head_man),
        create_type([x242, x140], head, head_woman),
        create_type([x242, x140], body, body_man),
        create_type([x242, x140], body, body_woman)
    ].

create_type([Size242, Size140], Part, Gender) ->
    Prefix242 = filename:join([code:priv_dir(empdb), t, Size242, Part, Gender]),
    Prefix140 = filename:join([code:priv_dir(empdb), t, Size140, Part, Gender]),

    create_rf([Prefix242, Prefix140], file:list_dir(Prefix242), [Size242, Size140], Part, Gender).

create_rf([Prefix242, Prefix140], {ok, Filelist}, [Size242, Size140], Part, Gender) ->
    lists:map(
        fun(Filename)->
            Bfilename = erlang:list_to_binary(Filename),

            {ok, Filebody242} = file:read_file(filename:join([Prefix242, Filename])),
            {ok, Filebody140} = file:read_file(filename:join([Prefix140, Filename])),


            {ok,[{[{file_id,    File_id_242}|_]}]} =
                empdb_biz_file:create([
                    {isres,         false},
                    {filebody,      Filebody242},
                    {filename,      Bfilename},
                    {nchanks,       1},
                    {contenttype,   undefined},
                    {fileextension, <<"png">>}
                ]),

            {ok,[{[{file_id,    File_id_140}|_]}]} =
                empdb_biz_file:create([
                    {isres,         false},
                    {filebody,      Filebody140},
                    {filename,      Bfilename},
                    {nchanks,       1},
                    {contenttype,   undefined},
                    {fileextension, <<"png">>}
                ]),

            [Bnumber1| _] = binary:split(Bfilename, <<".png">>),
            [Bnumber| _]  = binary:split(Bnumber1, <<"_95">>),
            Number =  empdb_convert:to_integer(Bnumber),

            Module =
                case Part of
                    head ->
                        empdb_biz_perspichead;
                    body ->
                        empdb_biz_perspicbody
                end,


                    %empdb_dao_perspicbody:create(emp, [
                         %{head,<<"284_95.png">>},
                         %{number,284},
                         %{alias,<<"284_95.png">>},
                         %{size,140},
                         %{ismale,false},
                         %{file_id,2216},
                         %{gender,body_man},
                         %{part,body},
                         %{x,32},
                         %{y,0}
                    %]),

            {ok,[{[{id,Eid242}|_]}]} =
                Module:create([
                    {head,         Bfilename},
                    {number,        Number},
                    {'size',        242},
                    {ismale,        ismale(Gender)},
                    {file_id,       File_id_242},
                    {gender,        Gender},
                    {part,          Part}
                    |get_coords(Bfilename, Size242, Part)
                ]),


            {ok,[{[{id,Eid140}|_]}]} =
                Module:create([
                    {head,          Bfilename},
                    {number,        Number},
                    {'size',        140},
                    {ismale,        ismale(Gender)},
                    {file_id,       File_id_140},
                    {gender,        Gender},
                    {part,          Part}
                    |get_coords(Bfilename, Size140, Part)
                ]),



            [
                {[
                    Module:update([
                        {id,Eid242},
                        {size_140_id, Eid140}
                    ]),
                    {number,        Number},
                    {head,          Bfilename},
                    {'size',        242},
                    {ismale,        ismale(Gender)},
                    {file_id,       File_id_242},
                    {gender,        Gender},
                    {part,          Part}
                    |get_coords(Bfilename, Size242, Part)
                ]},
                {[
                    Module:update([
                        {id,Eid140},
                        {size_242_id, Eid242}
                    ]),
                    {number,        Number},
                    {head,          Bfilename},
                    {'size',        140},
                    {ismale,        ismale(Gender)},
                    {file_id,       File_id_140},
                    {gender,        Gender},
                    {part,          Part}
                    |get_coords(Bfilename, Size140, Part)
                ]}
            ]
        end,
        Filelist
    ).


ismale(head_man) ->
    true;

ismale(body_man) ->
    true;

ismale(_) ->
    false.


